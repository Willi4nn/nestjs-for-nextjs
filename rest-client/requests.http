###############################################################################
# REST CLIENT - API Tests (NestJS)
###############################################################################

# @baseUrl = http://localhost:3001
@baseUrl = http://localhost:3001

# Variáveis de Teste (Configuração Inicial)
@userName = test
@userEmail = test@email.com
@userPassword = senha123
@userNewPassword = novaSenha123

# Variáveis Dinâmicas (Capturadas via @name)
@jwtToken = {{login.response.body.accessToken}}
@postId = {{createPost.response.body.id}}
@postSlug = {{createPost.response.body.slug}}

###############################################################################
# 1. AUTH & USER (Fluxo de Acesso)
###############################################################################

### Criar novo usuário
# @name createUser
POST {{baseUrl}}/user
Content-Type: application/json

{
  "name": "{{userName}}",
  "email": "{{userEmail}}",
  "password": "{{userPassword}}"
}


### Login (Obter Token JWT)
# @name login
POST {{baseUrl}}/auth/login
Content-Type: application/json

{
  "email": "{{userEmail}}",
  "password": "{{userPassword}}"
}

###############################################################################
# 2. USER PROFILE (Operações Autenticadas)
###############################################################################

### Buscar perfil atual
# @name getMe
GET {{baseUrl}}/user/me
Authorization: Bearer {{jwtToken}}


### Atualizar perfil
# @name updateProfile
PATCH {{baseUrl}}/user/me
Content-Type: application/json
Authorization: Bearer {{jwtToken}}

{
  "name": "{{userName}} Atualizado",
  "email": "{{userEmail}}"
}


### Alterar senha
# @name changePassword
PATCH {{baseUrl}}/user/me/password
Content-Type: application/json
Authorization: Bearer {{jwtToken}}

{
  "currentPassword": "{{userPassword}}",
  "newPassword": "{{userNewPassword}}"
}

###############################################################################
# 3. POSTS (CRUD)
###############################################################################

### Criar post
# @name createPost
POST {{baseUrl}}/post/me
Content-Type: application/json
Authorization: Bearer {{jwtToken}}

{
  "title": "Título do Post Exemplo",
  "excerpt": "Resumo rápido do conteúdo",
  "content": "Conteúdo detalhado do post para fins de teste de API.",
  "coverImageUrl": "http://localhost/placeholder.png"
}


### Listar posts (Público)
GET {{baseUrl}}/post


### Listar meus posts (Privado)
GET {{baseUrl}}/post/me/
Authorization: Bearer {{jwtToken}}


### Buscar post por Slug ou ID
GET {{baseUrl}}/post/{{postSlug}}


### Atualizar post
PATCH {{baseUrl}}/post/me/{{postId}}
Content-Type: application/json
Authorization: Bearer {{jwtToken}}

{
  "title": "Título Atualizado",
  "published": true
}


### Deletar post
DELETE {{baseUrl}}/post/me/{{postId}}
Authorization: Bearer {{jwtToken}}

###############################################################################
# 4. UPLOAD & MÍDIA
###############################################################################

### Upload de Imagem
# @name uploadImage
POST {{baseUrl}}/upload
Authorization: Bearer {{jwtToken}}
Content-Type: multipart/form-data; boundary=----WebKitFormBoundary7MA4YWxkTrZu0gW

------WebKitFormBoundary7MA4YWxkTrZu0gW
Content-Disposition: form-data; name="file"; filename="image.png"
Content-Type: image/png

< D:/Willian/Downloads/workspace/will/nestjs-for-nextjs/dev/images/image.png
------WebKitFormBoundary7MA4YWxkTrZu0gW--

### Visualizar Imagem Upada
@imageUrl = {{baseUrl}}{{uploadImage.response.body.url}}
GET {{imageUrl}}

###############################################################################
# 5. CLEANUP (Opcional)
###############################################################################

### Deletar conta do usuário
# @name deleteAccount
DELETE {{baseUrl}}/user/me
Authorization: Bearer {{jwtToken}}